<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
       "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <meta http-equiv="content-type" content="text/html;charset=UTF-8" />
  <title>
    <%=t :app_title %>
    <% if @course %>
      - <%= @course.code %>
    <% end %>
    <% if @instance %>
      - <%= @instance.name %>
    <% end %>
  </title>
  <%= stylesheet_link_tag 'theme' %>
  <% @stylesheets.each do |stylesheet| %>
    <%= stylesheet_link_tag stylesheet %>
  <% end %>
  
  <%= javascript_include_tag  :defaults %>
</head>
<body>

<!-- Logo -->
<div class="logo">
  <h1><%=t :app_title %></h1>
</div>

<!-- Top navigation bar -->
<div class="topNavi">
  <div class="extraButtons">
    <!-- Language -->
    <% # Only show the language button for GET requests. If the current page is the result of a POST request, doing a GET request to the same URL could lead to a different view or even a 404.
    if request.get? %>
      <ul class="language">
        <li><%= link_to 'FI', url_for(:overwrite_params => {:locale => 'fi'}) %></li>
        <li><%= link_to 'EN', url_for(:overwrite_params => {:locale => 'en'}) %></li>
      </ul>
    <% end %>
    
    <!-- Login -->
    <ul class="buttons">
      <% if logged_in? %>
        <li><%= link_to t(:logout_button), logout_url %></li>
      <% else %>
        <% if request.get? %>
          <li><%= link_to t(:login_button), url_for(:overwrite_params => {:require_login => true}) %></li>
        <% else %>
          <li><%= link_to t(:login_button), login_url %></li>
        <% end %>
      <% end %>
    </ul>
  </div>
</div>

<!-- Breadcrumbs -->
<ul class="breadcrumbs">
  <li><%= link_to t(:app_title), root_path %></li>
  <% if @course and !@course.new_record?%>
    <li>/ <%= link_to "#{@course.code} #{@course.name}", course_root_path(@course.code) %></li>
  <% end %>
  <% if @instance and !@instance.new_record? %>
    <li>/ <%= link_to @instance.name, instance_root_path(@instance.course.code, @instance.path) %></li>
  <% end %>
</ul>


<!-- User -->
<div class="loginInfo">
  <% if logged_in? %>
    <%= link_to current_user.name, edit_user_path(current_user) %>
  <% else %>
    <%=t :not_logged_in %>
  <% end %>
</div>

<div class="clear"></div>

<% if flash[:error] %>
  <div class="flashError"><%= flash[:error] %></div>
<% end
if flash[:warning] %>
  <div class="flashWarning"><%= flash[:warning] %></div>
<% end
if flash[:success] %>
  <div class="flashSuccess"><%= flash[:success] %></div>
<% end 
if flash[:notice] %>
  <div class="flashNotice"><%= flash[:notice] %></div>
<% end %>


<!-- Left navigation -->
<% if @course and !@course.new_record? %>
  <div class="sideNavi">
    <!-- Course -->
    <h2><%= link_to @course.name, @course %></h2>
    <!-- Instances -->
    <ul class="instances">
      <% @course.course_instances.each do |instance| %>
        <li class="<%= instance.active ? 'active' : 'inactive' %> <%= @instance && @instance.id == instance.id ? 'selected' : '' %>" >
          <%= link_to instance.name, instance_root_path(instance.course.code, instance.path) %>
        </li>
      <% end %>
    </ul>
  
  
    <ul class="naviButtons">
      <% if @course.faq_entries.length > 0 %>
        <li class="faqLink"><%= link_to 'FAQ', faq_path(@course.code) %></li>
      <% end %>
      <% if @instance %>
        <li class="feedbackLink"><%= link_to 'Feedback', topic_index_path(@instance.course.code, @instance.path) %></li>
      <% end %>
    </ul>
    
    <ul class="naviButtons">
      <% if @is_teacher || @is_admin %>
        <!--li class="settingsLink"><%= link_to 'Roles', edit_course_path(@course) %></li-->
        <li class="button settingsLink"><%= link_to 'Course', edit_course_path(@course) %></li>
        <% if @instance %>
          <li class="settingsLink"><%= link_to 'Instance', edit_course_instance_path(@instance) %></li>
        <% end %>
      <% end %>
    </ul>
  </div>
<% end %>


<div class="content">
  <div class="sheet-shadow">
    <div class="sheet">
<%= yield %>
    </div>
  </div>
</div>

</body>
</html>
